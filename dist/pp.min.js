(function(g){var d={};var c=false;var f=false;var e=false;var b=[];window.pp=function(h){if(pp.fn.isFunction(h)){c=true;g(function(){var i=function(){h.apply(window.pp);for(var j in window.pp){if(!window.pp.hasOwnProperty(j)){continue}if(j.toString().match(/^init/)){window.pp[j].call(pp)}}if(!f){f=true;pp.activate(g(document))}};if(!e){i.call()}else{b.push(i)}})}};pp.action=function(h){return new pp.ActionObject(h)};pp.ActionObject=function(k){var s=k;var j=null;var r={};var h;var p=10;var l=5;var v;var o;var t;var i;var n;var q=this;var m=null;var u;this.url=function(w){j=w;return this};this.action=function(w){s=w;return this};this.sender=function(w){u=w;return this};this.param=function(w,x){r[w]=x;return this};this.params=function(w){r=w;return this};this.timeout=function(w){p=w;return this};this.duration=function(w){l=w;return this};this.method=function(w){if(typeof(w)=="string"){m=w.toUpperCase()}return this};this.target=function(w){h=w;return this};this.before=function(w){if(pp.fn.isUndefined(w)){return v}v=w;return this};this.done=function(w){if(pp.fn.isUndefined(w)){return o}o=w;return this};this.success=function(w){if(pp.fn.isUndefined(w)){return t}t=w;return this};this.fail=function(w){if(pp.fn.isUndefined(w)){return i}i=w;return this};this.error=function(w){if(pp.fn.isUndefined(w)){return n}n=w;return this};this.post=function(){setTimeout(this._delayPost,0);return this};this._delayPost=function(){if(typeof(v)=="function"){var x=v.call(pp,this);if(typeof(x)=="boolean"&&!x){return this}}var w=j;if(j==null){w=pp.url(s)}g.ajax({timeout:Math.ceil(p*1000),type:"POST",data:r,url:w,dataType:"json",contentType:(r instanceof FormData)?false:"application/x-www-form-urlencoded; charset=UTF-8",processData:!(r instanceof FormData),success:function(z){if(typeof(o)=="function"){pp.sender=u;o.call(pp,q,z)}if(typeof(z)=="object"&&typeof(z.code)!="undefined"){if(u){u.find("*[class*='pp-message-']").hide();u.find(".pp-fail").removeClass("pp-fail");u.find(".pp-success").removeClass("pp-success");u.find(".pp-error").hide();u.find(".pp-ok").hide()}if(z.code==200){if(u){u.find(".pp-ok").show()}if(pp.fn.isFunction(t)){pp.sender=u;t.call(pp,z)}else{if(typeof(z.message)=="string"){alert(z.message)}if(pp.fn.isDefined(z.next)){if(z.next=="${self}"){window.location.reload()}else{pp.go(z.next)}}}}else{if(u){u.find(".pp-error").show()}var F=pp.fn.isDefined(z.errors)?z.errors:null;if(pp.fn.isArray(F)&&F.length>0&&u){for(var C=0;C<F.length;C++){var A=F[C];var E=A[0];var D=A[1][0][1];var y=u.find(".pp-message-"+E);var B=y.find(".pp-body");if(E&&D){y.show();if(B.length>0){B.html(D)}else{y.html(D)}}else{y.show();if(B.length>0){B.empty()}else{y.empty()}}if(C==0&&D){u.find(".pp-error .pp-error-body").html(D).show()}if(E){u.named(E).addClass("pp-fail");if(C==0){u.named(E).focus()}}}}else{if(!pp.fn.isFunction(i)&&z.message!=null){alert(z.message)}}if(pp.fn.isFunction(i)){var A=null;if(pp.fn.isArray(F)&&F.length>0){A={field:F[0][0],rule:F[0][1][0][0],message:F[0][1][0][1]}}pp.sender=u;i.call(pp,z,A)}}}},error:function(){if(typeof(n)=="function"){pp.sender=u;n.call(pp,q)}}});return this};this.get=function(){setTimeout(this._delayGet,0)};this._delayGet=function(){if(typeof(v)=="function"){var x=v.call(pp,this);if(typeof(x)=="boolean"&&!x){return this}}var w=j;if(j==null){w=pp.url(s)}g.ajax({timeout:Math.ceil(p*1000),type:"GET",data:r,url:w,dataType:"json",success:function(y){if(typeof(o)=="function"){o.call(pp,q,y)}},error:function(z,y){if(typeof(n)=="function"){n.call(pp,q,y)}else{pp.log("'get' error:"+y)}}});return this};this.pull=function(){if(typeof(v)=="function"){var x=v.call(pp,this);if(typeof(x)=="boolean"&&!x){return this}}if(!m){m=pp.action.GET}var w=j;if(j==null){w=pp.url(s)}g.ajax({timeout:Math.ceil(p*1000),type:m,data:r,url:w,dataType:"html",success:function(y){if(h){g(h).html(y);pp.activate(g(h))}if(typeof(o)=="function"){o.call(pp,q,y)}},error:function(){if(typeof(n)=="function"){n.call(pp,q)}}});return this};this.poll=function(){if(typeof(v)=="function"){var w=v.call(pp,this);if(typeof(w)=="boolean"&&!w){return this}}if(!m){m=pp.action.GET}this.param("_",(new Date()).getTime());g.ajax({timeout:Math.ceil(p*1000),type:m,data:r,url:pp.url(s),dataType:"json",success:function(x){if(h){g(h).html(x)}if(typeof(o)=="function"){o.call(pp,q,x)}setTimeout(function(){q.poll()},Math.ceil(l*1000))},error:function(){if(typeof(n)=="function"){n.call(pp,q)}setTimeout(function(){q.poll()},Math.ceil(l*1000))}});return this};return this};pp.nil=Number.MAX_VALUE-100;pp.action.POST="post";pp.action.GET="get";pp.on=function(i,h){if(i instanceof jQuery){i=i.attr("pp-action")}if(!pp.fn.isArray(i)){i=[i]}var j=new pp.ActionObject();if(pp.fn.isFunction(h)){j.done(h)}i.asArray().each(function(m,l){d[l]=j});return j};pp.url=function(j,k){this._trimPath=function(l){l=l.replace(/\/+/g,"/");if(l.substr(-1,1)=="/"){l=l.substr(0,l.length-1)}return l};var h;if(j.match(/\//)){h=j}else{if(j.substr(0,2)==".."){h=this._trimPath(window.location.pathname).replace(/\/\w+\/\w+$/,"")+"/"+j.substr(2).replace(/\./g,"/")}else{if(j.substr(0,1)=="."){h=this._trimPath(window.location.pathname).replace(/\/\w+$/,"")+"/"+j.substr(1).replace(/\./g,"/")}else{h=j.replace(/\./g,"/");if(h.length>0&&h.substring(0,1)!="/"){h="/"+h}else{h="/"}}}}if(typeof(k)=="object"){var i=g.param(k);if(i.length>0){h+="?"+i}}if(!h.match(/^(http|https|ftp):/i)){h=pp.config.base+((h.substr(0,1)=="/")?"":"/")+h}return h};pp.go=function(h,i){window.location.href=pp.url(h,i)};pp.fn={};pp.fn.isFunction=function(h){return(typeof(h)=="function")};pp.fn.isUndefined=function(h){return(typeof(h)=="undefined")};pp.fn.isDefined=function(h){return !pp.fn.isUndefined(h)};pp.fn.isBoolean=function(h){return(typeof(h)=="boolean")};pp.fn.isYes=function(h){return(typeof(h)=="boolean"&&h)};pp.fn.isNo=function(h){return(typeof(h)=="boolean"&&!h)};pp.fn.isObject=function(h){return(typeof(h)=="object")};pp.fn.isArray=function(h){return(h instanceof Array)};g.fn.named=function(h){return this.find("*[name='"+h+"']")};pp.log=function(){if(!pp.config.log){return}if(pp.fn.isObject(console)&&pp.fn.isFunction(console.log)){var h=[];for(var j=0;j<arguments.length;j++){h.push(arguments[j])}return console.log.apply(console,h)}};pp.activate=function(h){h.find("*[pp-action]").each(function(){var j=g(this);var i=j[0].tagName.toUpperCase();if(i=="FORM"){j.submit(function(){var q=j.attr("pp-action");var o=new FormData(j[0]);if(pp.fn.isUndefined(d[q])){d[q]=new pp.ActionObject()}var p=d[q];if(typeof(q)=="string"){var n=q.match(/^url:(.+)$/);if(n){q=n[1]}}p.sender(j).params(o).action(q).post();return false})}else{var k=j.attr("pp-action");if(typeof(d[k])!="undefined"){var l=d[k];var m=l.before();if(pp.fn.isFunction(m)){m.call(pp,j)}}j.click(function(){var q=j.attr("pp-action");if(typeof(d[q])!="undefined"){var r=d[q];var n=r.done();if(pp.fn.isFunction(n)){n.call(pp,j)}}else{var t=new pp.ActionObject();var v=j[0].attributes;var p={};for(var s=0;s<v.length;s++){var u=v[s];var w=u.name.match(/^data-(.+)/);if(!w){continue}var o=w[1].replace(/-/g,"_");p[o]=u.value}t.sender(j).params(p).action(q).post()}return false})}j.param=function(n,o){if(pp.fn.isUndefined(o)){return g(this).attr("pp-data-"+n)}g(this).attr("pp-data-"+n,o);return o};j.action=function(){return g(this).attr("pp-action")}})};pp.batch=function(h){for(var i in window.pp){if(!window.pp.hasOwnProperty(i)||i=="batch"){continue}if(i.toString().match(new RegExp("^"+h))){window.pp[i].call(pp)}}};pp.Timer=function(k){var n=0;var m=1;var l=1;var h=1;var j;var i=this;if(!pp.fn.isFunction(k)){pp.log("Timer should input a function");return}this._runFn=function(){if(h==-1&&j){clearInterval(j);j=null;return}h--;k.call(this)};this.run=function(){h=l;if(h==1){j=setTimeout(function(){i._runFn()},n*1000)}else{if(h==0){return this}else{h--;if(h<0||h>0){j=setTimeout(function(){i._runFn();j=setInterval(function(){i._runFn()},m*1000)},n*1000)}}}return this};this.delay=function(o){n=o;return this};this.duration=function(o){m=o;return this};this.repeat=function(o){l=o;return this};this.infinite=function(){l=-1;return this};this.cancel=function(){if(j){clearTimeout(j);clearInterval(j);j=null}h=l;return this};this.pause=function(){if(j){clearTimeout(j);clearInterval(j);j=null}return this};this.resume=function(){if(j){return this}if(h!=0){j=setInterval(function(){i._runFn()},m*1000)}return this};return this};pp.Array=function(){if(this instanceof Function){var h=new pp.Array();h._init(arguments);return h}pp.mixIn(this,pp.Iterator);var i=[];this._init=function(j){if(pp.fn.isUndefined(j)){return}if(j.length==0){i=[]}else{if(j.length==1&&typeof(j[0])=="object"&&pp.fn.isDefined(j[0].length)){for(var k=0;k<j[0].length;k++){i.push(j[0][k])}}else{for(var k=0;k<arguments.length;k++){i.push(j[k])}}}};this.contains=function(l,j){var k=this.keys(l,j);return(k.length>0)};this.keys=function(m,j){var l=[];if(!pp.fn.isDefined(j)){j=false}for(var k=0;k<i.length;k++){if((j&&m===i[k])||(!j&&m==i[k])){l.push(k)}}return l};this.push=function(k){i.push(k);if(arguments.length>1){for(var j=1;j<arguments.length;j++){i.push(arguments[j])}}};this.pop=function(){return i.pop()};this.remove=function(j){j=parseInt(j,10);var l=new pp.Array();if(i.length>=j+1&&j>-1){for(var k=0;k<i.length;k++){if(k!=j){l.push(i[k])}}}else{l=this}i=l.values()};this.removeValue=function(l,m){var k=this.keys(l,m);for(var j=0;j<k.length;j++){this.remove(k[j])}};this.values=function(){return i};this.length=function(){return i.length};this.count=function(){return this.length()};this.get=function(j){if(j>this.length()){return null}return i[j]};this.set=function(j,k){i[j]=k};this.sort=function(j){if(!pp.fn.isDefined(j)){j=function(l,k){if(l>k){return 1}else{if(l==k){return 0}else{return -1}}}}i.sort(j)};this.rsort=function(j){this.sort(j);this.reverse()};this.asort=function(k){var m=new pp.Array();for(var n=0;n<i.length;n++){m.push(n)}if(!pp.fn.isDefined(k)){k=function(o,j){if(o<j){return -1}if(o>j){return 1}return 0}}for(var n=0;n<i.length;n++){for(var l=0;l<i.length;l++){if(l>0&&k(i[l-1],i[l])>0){this.swap(l,l-1);m.swap(l,l-1)}}}return m};this.arsort=function(j){var k=this.asort(j);this.reverse();k.reverse();return k};this.reverse=function(){i=i.reverse();return this};this.swap=function(m,l){var k=this.get(m);var j=this.get(l);this.set(m,j);this.set(l,k)};this.clear=function(){i=[]};this.toString=function(){return i.toString()};this.unique=function(j){var l=new pp.Array();for(var k=0;k<i.length;k++){if(!l.contains(i[k],j)){l.push(i[k])}}return l};this.copy=function(){return new pp.Array(i)};this.max=function(j){if(this.length()>0){var k=this.copy();k.rsort(j);return k.get(0)}return null};this.min=function(j){if(this.length()>0){var k=this.copy();k.sort(j);return k.get(0)}return null};this.empty=function(){return(i.length==0)};this.concat=function(){for(var j=0;j<arguments.length;j++){if(arguments[j] instanceof Array){i=i.concat(arguments[j])}else{if(arguments[j] instanceof pp.Array){i=i.concat(arguments[j].values())}else{i=i.concat(arguments[j])}}}};this.join=function(j){return i.join(j)};this.shift=function(){return i.shift()};this.unshift=function(){for(var j=0;j<arguments.length;j++){i.unshift(arguments[j])}};this.slice=function(l,k){if(!pp.fn.isDefined(k)){k=i.length}if(k<0){k=0}var j=(l>0)?l+k:i.length;return(new pp.Array(i.slice(l,j)))};this.splice=function(k,j){return new pp.Array(i.splice.apply(i,arguments))};this.splice$=function(l,j){var k=this.copy();k.splice.apply(k.values(),arguments);return k};this.diff=function(k){var j=new pp.Array();this.each(function(m,l){if(!k.include(l)){j.push(l)}});return j};this.intersect=function(k){var j=new pp.Array();this.each(function(m,l){if(k.include(l)){j.push(l)}});return j};this._init(arguments);return this};Array.prototype.asArray=function(){return new pp.Array(this)};pp.range=function(m,h,k){var l=[];if(!pp.fn.isDefined(k)){k=1}if(m<h){for(var j=m;j<=h;j+=k){l.push(j)}}else{for(var j=m;j>=h;j-=k){l.push(j)}}return new pp.Array(l)};pp.Iterator={each:function(l){if(typeof(l)!="function"){throw new Error(this.toString()+" each: iterator is not a function.")}var h;if(this instanceof pp.Array){h=this}else{if(pp.fn.isFunction(this.asEntries)){h=this.asEntries();if(!(h instanceof pp.Array)){pp.log("'asEntries' should return an 'pp.Array' object");return}}}if(!h){pp.log("'asEntries' should be implemented");return}var j=0;for(var i=0;i<h.length();i++){var m=h.get(i);try{if(m instanceof pp.Entry){if(m.key===null){m.key=j;j++}l.call(this,m.key,m.value)}else{l.call(this,i,m)}}catch(n){if(n instanceof pp.Iterator.Break){break}else{if(n instanceof pp.Iterator.Continue){continue}else{throw n}}}}},all:function(i){var h=true;this.each(function(l,j){if(!i(l,j)){h=false;pp_break()}});return h},any:function(i){var h=false;this.each(function(l,j){if(i(l,j)){h=true;pp_break()}});return h},collect:function(h){var i=new pp.Array();this.each(function(l,j){i.push(h(l,j))});return i},find:function(i){var h=null;this.each(function(l,j){if(i(l,j)){h=new pp.Entry(l,j);pp_break()}});return h},entries:function(){var h=new pp.Array();this.each(function(j,i){h.push(new pp.Entry(j,i))});return h},findAll:function(i){var h=new pp.Array();this.each(function(l,j){if(i(l,j)){h.push(new pp.Entry(l,j))}});return h},reject:function(i){var h=new pp.Array();this.each(function(l,j){if(!i(l,j)){h.push(new pp.Entry(l,j))}});return h},include:function(i){var h=this.find(function(l,j){if(j==i){return true}});return(h!=null)},grep:function(h){if(!(h instanceof RegExp)){h=new RegExp(h)}return this.findAll(function(j,i){return h.test(i.toString())})},inject:function(h,i){this.each(function(l,j){h=i(h,l,j)});return h}};pp.Iterator.Break=function(){};pp.Iterator.Continue=function(){};window.pp_continue=function(){throw new pp.Iterator.Continue()};window.pp_break=function(){throw new pp.Iterator.Break()};pp.mixIn=function(h,j){for(var i in j){try{if(j.hasOwnProperty(i)){h[i]=j[i]}}catch(k){throw new Error("pp.mixIn: get a error when set property: "+i)}}};var a=[].asArray();pp.require=function(){var i=new pp.Array();var h=[];new pp.Array(arguments).each(function(k,l){if(pp.fn.isFunction(l)){h.push(l);return}var j=l+".js";if(pp.fn.isDefined(pp.config.versions[l])){j+="?v="+pp.config.versions[l]}var m=pp.config.js+"/"+j;if(a.contains(m)||i.contains(m)){return}i.push(m)});if(i.length()==0){if(i.length()==0&&h.length>0){h.asArray().each(function(l,j){j.call()})}return}e=true;i.each(function(j,k){g.ajax({url:k,type:"get",dataType:"script",async:true,cache:true,success:function(){a.push(k);i.removeValue(k);if(i.length()==0){if(h.length>0){h.asArray().each(function(m,l){l.call()})}if(b.length>0){b.asArray().each(function(m,l){l.call()});b=[]}}}})})};pp.Entry=function(h,i){if(pp.fn.isUndefined(i)){i=h;h=null}this.key=h;this.value=i};pp.config={js:"/js",base:"",log:true,versions:{}};if(!c){g(function(){if(!c){pp.activate(g(document))}})}window.pp=pp})(jQuery);